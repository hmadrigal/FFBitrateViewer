<rxui:ReactiveUserControl xmlns="https://github.com/avaloniaui"
             xmlns:rxui="http://reactiveui.net"
             x:TypeArguments="vm:BitRateViewModel"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:FFBitrateViewer.ApplicationAvalonia.ViewModels"
             xmlns:m="clr-namespace:FFBitrateViewer.ApplicationAvalonia.Models.Media"
             xmlns:Avalonia_Controls_Converters="using:Avalonia.Controls.Converters"
             xmlns:local_converters="using:FFBitrateViewer.ApplicationAvalonia.Extensibility.AvaloniaUI"
             xmlns:DesignData="using:FFBitrateViewer.ApplicationAvalonia.DesignData.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="FFBitrateViewer.ApplicationAvalonia.Views.BitRateView"
             x:DataType="vm:BitRateViewModel"
             x:CompileBindings="True"
             xmlns:pgc="clr-namespace:Avalonia.PropertyGrid.Controls;assembly=Avalonia.PropertyGrid"
             xmlns:i="clr-namespace:Avalonia.Xaml.Interactivity;assembly=Avalonia.Xaml.Interactivity"
             xmlns:ia="clr-namespace:Avalonia.Xaml.Interactions.Core;assembly=Avalonia.Xaml.Interactions"
             xmlns:ScottPlot_Avalonia="clr-namespace:ScottPlot.Avalonia;assembly=ScottPlot.Avalonia"
             x:Name="BitRateViewUserControl" Padding="8,4"
             >

    <UserControl.Resources>
        <Avalonia_Controls_Converters:EnumToBoolConverter x:Key="EnumToBoolConverter"/>
        <StreamGeometry x:Key="speaker_off_regular">M23.765011,8.0000009C28.673002,10.572999 32,14.597993 32,14.597993 32,14.597993 24.836025,23.289004 15.999993,23.289004 14.338004,23.289004 12.736014,22.981997 11.230001,22.483004L13.476004,19.888003C14.297996,20.071001 15.14202,20.177996 15.999993,20.177996 20.866999,20.177996 25.304013,16.854006 27.754027,14.597993 26.413998,13.364992 24.473995,11.821 22.202021,10.666994 22.378016,11.181001 22.476008,11.724 22.476008,12.287004 22.476008,15.406999 19.576014,17.935992 15.999993,17.935992 15.730004,17.935992 15.467002,17.916994 15.206992,17.888995L21.683008,10.405992z M15.999993,5.905991C16.775994,5.905991,17.530998,5.9929966,18.277001,6.1149906L17.657006,6.8329934 17.658013,6.8329934 10.439,15.171998C9.8609974,14.326997 9.523,13.343004 9.523,12.287004 9.523,11.720994 9.6210072,11.175996 9.799001,10.660997 7.5229986,11.813005 5.5860012,13.364 4.2460043,14.597993 5.2729976,15.545 6.656009,16.679003 8.2710001,17.677996L6.2420075,20.022005C2.4510052,17.556002 0,14.597993 0,14.597993 0,14.597993 7.164005,5.905991 15.999993,5.905991z M25.689022,0L27.337004,1.4279938 4.5599997,27.742999 2.912004,26.317004z</StreamGeometry>
        <StreamGeometry x:Key="speaker_regular">M9.8010254,4.7550061C7.5220032,5.9089983 5.5870056,7.4539969 4.2440186,8.692004 6.6970215,10.949008 11.129028,14.271 15.996033,14.271 20.863037,14.271 25.30304,10.949008 27.747986,8.692004 26.413025,7.4539969 24.470032,5.9089983 22.197998,4.7550061 22.377991,5.2720044 22.475037,5.8119982 22.475037,6.3820055 22.475037,9.5010097 19.572998,12.02901 15.996033,12.02901 12.419006,12.02901 9.5240173,9.5010097 9.5240173,6.3820055 9.5240173,5.8119982 9.6220093,5.2720044 9.8010254,4.7550061z M15.996033,0C24.830017,1.9660001E-07 32,8.692004 32,8.692004 32,8.692004 24.830017,17.383 15.996033,17.383 7.1620178,17.383 0,8.692004 0,8.692004 0,8.692004 7.1620178,1.9660001E-07 15.996033,0z</StreamGeometry>
		<local_converters:SystemDrawingColorToBrushConverter  x:Key="system_drawing_color_to_brush"/>
    </UserControl.Resources>

    <UserControl.Styles>
        <Style Selector="ToggleButton PathIcon.eye-open">
            <Setter Property="IsVisible" Value="False"/>
        </Style>
        <Style Selector="ToggleButton:checked PathIcon.eye-open">
            <Setter Property="IsVisible" Value="True"/>
        </Style>
        <Style Selector="ToggleButton PathIcon.eye-closed">
            <Setter Property="IsVisible" Value="True"/>
        </Style>
        <Style Selector="ToggleButton:checked PathIcon.eye-closed">
            <Setter Property="IsVisible" Value="False"/>
        </Style>
    </UserControl.Styles>

    <i:Interaction.Behaviors>
        <ia:EventTriggerBehavior EventName="Loaded" SourceObject="BitRateViewUserControl">
            <ia:ChangePropertyAction TargetObject="{Binding DataContext, ElementName=BitRateViewUserControl}" PropertyName="PlotController" Value="{Binding ElementName=PlotControl,Mode=OneTime}" />
            <!--<ia:ChangePropertyAction TargetObject="{Binding DataContext, ElementName=BitRateViewUserControl}" PropertyName="PlotModelData" Value="{Binding ActualModel, ElementName=PlotControl}" />
            <ia:ChangePropertyAction TargetObject="{Binding DataContext, ElementName=BitRateViewUserControl}" PropertyName="PlotControllerData" Value="{Binding ActualController, ElementName=PlotControl}" />-->
            <ia:InvokeCommandAction Command="{Binding LoadedCommand,Mode=OneTime}" />
        </ia:EventTriggerBehavior>
    </i:Interaction.Behaviors>

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
         to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <DesignData:DesignBitRateViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto,Auto,0.4*,4,0.6*,Auto">

        <!-- Menu -->
        <Menu Grid.Row="0">
            <MenuItem Header="_File">
                <MenuItem Header="E_xit" Command="{Binding ExitCommand,Mode=OneTime}" />
            </MenuItem>
            <MenuItem Header="A_ctions">
                <MenuItem Header="_Add files…" Command="{Binding AddFilesCommand,Mode=OneTime}" />
                <MenuItem Header="_Remove selected files" Command="{Binding RemoveSelectedFilesCommand,Mode=OneTime}"/>
                <MenuItem Header="Remove ALL files" Command="{Binding RemoveAllFilesCommand,Mode=OneTime}"/>
                <Separator/>
                <MenuItem Header="Refresh _media info" Command="{Binding RefreshMediaInfoCommand,Mode=OneTime}" />
                <Separator/>
                <MenuItem Header="_Start" Command="{Binding ToggleOnOffPlotterPlotterCommand,Mode=OneTime}"/>
                <MenuItem Header="St_op" Command="{Binding ToggleOnOffPlotterPlotterCancelCommand,Mode=OneTime}" />
                <Separator/>
                <!--<MenuItem Header="Copy plot to _clipboard" Command="{Binding CopyPlotToClipboardCommand,Mode=OneTime}" />-->
                <MenuItem Header="Save plot to _file…" Command="{Binding SavePlotToFileCommand,Mode=OneTime}"/>
            </MenuItem>
            <!--<MenuItem Header="_Options">
                <MenuItem Header="Write _FFProbe commands to log">
                    <MenuItem.Icon>
                        <CheckBox BorderThickness="0"
                                  IsHitTestVisible="False"
                                  Command="{Binding  }">
                            Toggle _Me
                        </CheckBox>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>-->
            <MenuItem Header="_Help">
                <MenuItem Header="_About" Command="{Binding GoToAboutViewCommand,Mode=OneTime}"/>
            </MenuItem>
        </Menu>

        <!--buttons-->
        <Border Grid.Row="1" >
            <StackPanel Orientation="Horizontal" >
                <Button Margin="2,2" Content="Add file" Command="{Binding AddFilesCommand,Mode=OneTime}"/>
                <Button Margin="2,2" Content="Remove selected" Command="{Binding RemoveSelectedFilesCommand,Mode=OneTime}" />
            </StackPanel>
        </Border>

        <!-- data grid-->
        <Border Grid.Row="2">
            <Grid ColumnDefinitions="*,4,Auto">

                <DataGrid Margin="2,4" Grid.Column="0" Name="FileDataGrid" ItemsSource="{Binding Files,Mode=OneTime}"
                      CanUserReorderColumns="True"
                      CanUserResizeColumns="True"
                      CanUserSortColumns="False"
                      GridLinesVisibility="All"
                      BorderThickness="1" BorderBrush="Gray"
                      SelectionMode="Extended" SelectedItem="{Binding SelectedFile}"
                      >
                    <i:Interaction.Behaviors>
                        <ia:EventTriggerBehavior EventName="SelectionChanged" SourceObject="FileDataGrid">
                            <ia:ChangePropertyAction TargetObject="{Binding DataContext, ElementName=BitRateViewUserControl}" PropertyName="SelectedFiles" Value="{Binding Path=SelectedItems,ElementName=FileDataGrid,Mode=OneTime}" />
                            <!--<ia:InvokeCommandAction Command="{Binding RemoveSelectedFilesCommand,Mode=OneTime}"  />-->
                        </ia:EventTriggerBehavior>
                    </i:Interaction.Behaviors>
                    <DataGrid.Columns>
                        <DataGridTemplateColumn Header="Is Active">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <ToggleButton IsChecked="{Binding IsActive, Mode=TwoWay}"
                                                  VerticalAlignment="Center" HorizontalAlignment="Center"
                                                  Background="Transparent" BorderBrush="Transparent"
                                                  Padding="0" BorderThickness="0"
                                                  >
                                        <Panel Background="{Binding ScatterLineColor,Converter={StaticResource system_drawing_color_to_brush}}">
                                            <PathIcon Classes="eye-open"
                                                      Data="{StaticResource speaker_regular}" />
                                            <PathIcon Classes="eye-closed"
                                                      Data="{StaticResource speaker_off_regular}" />
                                        </Panel>
                                    </ToggleButton>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <!--<DataGridCheckBoxColumn Header="Is Active" Binding="{Binding IsActive}" IsReadOnly="False" />-->
                        <DataGridTextColumn Header="Path to file"  Binding="{Binding Path.LocalPath,Mode=OneWay}" IsReadOnly="True" />
                        <DataGridTextColumn Header="Media Info" Binding="{Binding FirstVideoShortDesc,Mode=OneWay}" IsReadOnly="True" />
                        <DataGridTextColumn Header="Bit Rate (avg)" Binding="{Binding BitRateAverage,Mode=OneWay,StringFormat=' {0:n} kb/s'}" IsReadOnly="True" />
                        <DataGridTextColumn Header="Bit Rate (max)" Binding="{Binding BitRateMaximum,Mode=OneWay,StringFormat=' {0:n} kb/s'}" IsReadOnly="True" />
                    </DataGrid.Columns>
                </DataGrid>

                <GridSplitter Margin="1,2" Grid.Column="1" ResizeDirection="Columns" Background="LightGray" BorderBrush="Gray" BorderThickness="1"/>

                <ScrollViewer Grid.Column="2">
                    <pgc:PropertyGrid Margin="4,2" DataContext="{Binding SelectedFile}" />
                </ScrollViewer>

            </Grid>
        </Border>

        <!--<DataGrid Grid.Row="2" ItemsSource="{Binding Files,Mode=OneTime}"
                  HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                  AutoGenerateColumns="True"
                  GridLinesVisibility="All"
                  BorderThickness="1" BorderBrush="Gray">
        </DataGrid>-->

        <GridSplitter Grid.Row="3" ResizeDirection="Rows" Margin="2,1" Background="LightGray" BorderBrush="Gray" BorderThickness="1"/>

        <!-- buttons and plot -->
        <Border Grid.Row="4" Padding="2,4">

            <Grid RowDefinitions="Auto,*">
                <!--Button and check buttons-->
                <Border Grid.Row="0" Padding="3 1">
                    <StackPanel Orientation="Horizontal">
                        <Button Margin="2 1" Content="Start" Command="{Binding ToggleOnOffPlotterPlotterCommand,Mode=OneTime}"/>
                        <Button Margin="2 1" Content="Stop" Command="{Binding ToggleOnOffPlotterPlotterCancelCommand,Mode=OneTime}"/>
                        <Label Margin="2 1" Content="Plot view:" VerticalAlignment="Center" />
                        <RadioButton Margin="2 1" GroupName="PotViewGroupName" Content="Frame based"
                                     IsChecked="{Binding PlotView, Converter={StaticResource EnumToBoolConverter}, ConverterParameter={x:Static m:PlotViewType.FrameBased}}"
                         />
                        <RadioButton Margin="2 1" GroupName="PotViewGroupName" Content="Second based"
                                     IsChecked="{Binding PlotView, Converter={StaticResource EnumToBoolConverter}, ConverterParameter={x:Static m:PlotViewType.SecondBased}}"
                         />
                        <Label Margin="2 1" Content="Adjust frame start time" VerticalAlignment="Center"/>
                        <CheckBox Margin="2 1" IsChecked="{Binding HasToAdjustFrameStartTime}"></CheckBox>
                        <Button Margin="2 1"
                            Command="{Binding AutoScaleCommand,Mode=OneTime}"
                            Content="AutoScale" />
                    </StackPanel>
                </Border>

                <!--Plot view-->
                <Border Grid.Row="1" >
                    <ScottPlot_Avalonia:AvaPlot Name="PlotControl">
                        <i:Interaction.Behaviors>
                            <ia:EventTriggerBehavior EventName="PointerMoved" SourceObject="PlotControl">
                                <ia:InvokeCommandAction Command="{Binding PlotPointerMovedCommand,Mode=OneTime}" PassEventArgsToCommand="True" />
                            </ia:EventTriggerBehavior>
                        </i:Interaction.Behaviors>
                    </ScottPlot_Avalonia:AvaPlot>
                </Border>

            </Grid>

        </Border>

        <!--Status bar-->
        <Border Grid.Row="5" Margin="0,0">
            <Grid >
                <TextBlock Text="{Binding Version}" />
            </Grid>
        </Border>

    </Grid>

</rxui:ReactiveUserControl>
